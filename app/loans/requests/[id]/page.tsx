\'use client\';\n\nimport { useEffect, useState } from \'react\';\nimport { sdk } from \'@/lib/sdk\';\nimport { useAuth } from \'@/hooks/AuthContext\';\nimport { useParams, useRouter } from \'next/navigation\';\nimport { LoanRequest, LoanOffer } from \'@shared/schema\'; // Assuming shared types exist\n\ninterface LoanRequestDetails extends LoanRequest {\n  offers: LoanOffer[];\n}\n\nexport default function LoanRequestDetailsPage() {\n  const { user, isAuthenticated } = useAuth();\n  const router = useRouter();\n  const params = useParams();\n  const { id } = params;\n\n  const [request, setRequest] = useState<LoanRequestDetails | null>(null);\n  const [error, setError] = useState<string | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n\n  useEffect(() => {\n    async function fetchRequestDetails() {\n      if (!id) return;\n      try {\n        const details = await sdk.loans.getLoanRequestDetails(id as string);\n        setRequest(details);\n      } catch (err: any) {\n        setError(err.message || \'Failed to fetch request details.\');\n      } finally {\n        setIsLoading(false);\n      }\n    }\n    fetchRequestDetails();\n  }, [id]);\n\n  const handleMakeOffer = async () => {\n    if (!id) return;\n    try {\n      await sdk.loans.createLoanOffer(id as string);\n      // Optimistically add the offer to the UI or refetch details\n      alert(\'Offer made successfully!\');\n      router.refresh(); // Refetch data\n    } catch (err: any) {\n      setError(err.message || \'Could not make an offer.\');\n    }\n  };\n\n  // This would be the start of formalizing the loan\n  const handleAcceptOffer = (offer: LoanOffer) => {\n    // For now, just a placeholder. In a real app, this would navigate\n    // to a new page to finalize the loan agreement details.\n    alert(`Accepting offer from ${offer.offerer.name}. Next step: Finalize agreement.`);\n    // Example: router.push(`/loans/new-agreement?offerId=${offer.id}`);\n  };\n\n  if (isLoading) return <div className=\"text-center p-10\">Loading request...</div>;\n  if (error) return <div className=\"text-red-500 text-center p-10\">Error: {error}</div>;\n  if (!request) return <div className=\"text-center p-10\">Request not found.</div>;\n\n  const isMyRequest = user?.id === request.requesterId;\n  const hasUserOffered = request.offers.some(offer => offer.offererId === user?.id);\n\n  return (\n    <div className=\"container mx-auto p-4 max-w-3xl font-inter\">\n       <button onClick={() => router.back()} className=\"mb-6 text-sm text-gray-600 hover:text-gray-800\">\n        &larr; Voltar\n      </button>\n      <div className=\"bg-white rounded-lg border border-gray-200 shadow-sm p-8\">\n        <h1 className=\"text-3xl font-bold font-poppins text-gray-800\">{request.itemName}</h1>\n        <p className=\"mt-2 text-gray-600\">{request.description}</p>\n        <p className=\"mt-4 text-sm text-gray-500\">Pedido por: <span className=\"font-medium\">{request.requester.name}</span></p>\n        <p className=\"text-sm text-gray-500\">Duração desejada: <span className=\"font-medium\">{request.duration}</span></p>\n\n        <hr className=\"my-6\" />\n\n        {/* Action Button */}\n        {!isMyRequest && !hasUserOffered && isAuthenticated && (\n          <div className=\"text-center\">\n            <button \n              onClick={handleMakeOffer}\n              className=\"px-8 py-3 font-bold text-white bg-green-600 rounded-lg hover:bg-green-700\">\n              Eu Empresto!\n            </button>\n          </div>\n        )}\n        {!isMyRequest && hasUserOffered && (\n           <p className=\"text-center text-green-700 font-semibold bg-green-100 p-3 rounded-md\">Você já se ofereceu para emprestar este item.</p>\n        )}\n\n        {/* Offers Section */}\n        {isMyRequest && (\n          <div>\n            <h2 className=\"text-2xl font-bold text-gray-700 mb-4\">Ofertas Recebidas</h2>\n            <div className=\"space-y-3\">\n              {request.offers.length > 0 ? (\n                request.offers.map(offer => (\n                  <div key={offer.id} className=\"p-4 bg-gray-50 rounded-lg flex justify-between items-center\">\n                    <p className=\"font-semibold text-gray-800\">{offer.offerer.name} se ofereceu para emprestar.</p>\n                    <button \n                      onClick={() => handleAcceptOffer(offer)}\n                      className=\"px-4 py-2 text-sm font-bold text-white bg-blue-600 rounded-md hover:bg-blue-700\">\n                      Aceitar Oferta\n                    </button>\n                  </div>\n                ))\n              ) : (\n                <p className=\"text-gray-500\'>Nenhuma oferta recebida ainda.</p>\n              )}\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n