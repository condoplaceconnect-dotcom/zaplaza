\'use client\';\n\nimport { useState } from \'react\';\nimport { useRouter, useParams } from \'next/navigation\';\nimport { loanSDK } from \'@/lib/loanSDK\';\nimport { useAuth } from \'@/hooks/AuthContext\';\n
const DIGITAL_TERM = `Eu, o solicitante, confirmo o recebimento do item em bom estado e me comprometo a devolvê-lo nas mesmas condições, na data combinada. Estou ciente de que qualquer dano ou a não devolução do item é de minha inteira responsabilidade, sujeito às regras do condomínio.`;\n\nexport default function FormalizeLoanPage() {\n  const { offerId } = useParams();\n  const router = useRouter();\n  const { isAuthenticated } = useAuth();\n\n  const [agreedReturnDate, setAgreedReturnDate] = useState(\'\');\n  const [acceptedTerm, setAcceptedTerm] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n\n  if (!isAuthenticated) {\n    router.push(\'/login\');\n    return null;\n  }\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!acceptedTerm) {\n        setError(\'Você precisa aceitar o Termo de Responsabilidade para continuar.\');\n        return;\n    }\n    setError(null);\n    setIsSubmitting(true);\n\n    try {\n      const newLoan = await loanSDK.agreements.create({\n        offerId: offerId as string,\n        agreedReturnDate: new Date(agreedReturnDate),\n        digitalTerm: DIGITAL_TERM,\n      });\n      // Redirect to the newly created loan details page\n      router.push(`/loans/${newLoan.id}`);\n    } catch (err: any) {\n      setError(err.message || \'Falha ao formalizar o empréstimo. Tente novamente.\');\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n
  return (\n    <div className=\"container mx-auto p-4 max-w-2xl\">\n      <h1 className=\"text-3xl font-bold font-poppins text-gray-800 mb-6\">Formalizar Empréstimo</h1>\n      <form onSubmit={handleSubmit} className=\"p-8 bg-white rounded-lg border border-gray-200 shadow-sm space-y-6\">\n        \n        <div>\n          <label htmlFor=\"returnDate\" className=\"block text-sm font-medium text-gray-700 mb-1\">Data Combinada para Devolução</label>\n          <input \n            id=\"returnDate\" \n            type=\"date\" \n            value={agreedReturnDate} \n            onChange={(e) => setAgreedReturnDate(e.target.value)} \n            required \n            className=\"w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500\" />\n        </div>\n
        <div>\n            <h3 className=\"text-lg font-semibold text-gray-800 mb-2\">Termo de Responsabilidade Digital</h3>\n            <div className=\"p-4 bg-gray-50 border border-gray-200 rounded-md text-sm text-gray-600\">\n                <p>{DIGITAL_TERM}</p>\n            </div>\n        </div>\n
        <div className=\"flex items-center\">\n            <input \n                id=\"acceptTerm\" \n                type=\"checkbox\" \n                checked={acceptedTerm} \n                onChange={(e) => setAcceptedTerm(e.target.checked)} \n                className=\"h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500\" />\n            <label htmlFor=\"acceptTerm\" className=\"ml-2 block text-sm text-gray-900\">Li e concordo com o Termo de Responsabilidade.</label>\n        </div>\n
        {error && <p className=\"text-sm text-red-600\">{error}</p>}\n\n        <div>\n          <button type=\"submit\" disabled={isSubmitting || !acceptedTerm} className=\"w-full px-6 py-3 font-bold text-white bg-blue-600 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:bg-gray-400\">\n            {isSubmitting ? \'Finalizando Acordo...\' : \'Finalizar Acordo e Criar Empréstimo\'}\n          </button>\n        </div>\n      </form>\n    </div>\n  );\n}\n